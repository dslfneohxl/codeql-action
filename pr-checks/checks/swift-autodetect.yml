# This check should be combined into `multi-language-autodetect.yml` once Ruby is GA'ed 
# and the `CODEQL_ENABLE_EXPERIMENTAL_FEATURES_SWIFT` environment variable is not needed.
name: "Swift analysis using autodetect"
description: "Tests creation of a Swift database when language isn't specified in init"
versions: ["latest", "cached", "nightly-latest"]
operatingSystems: ["ubuntu", "macos"]
env:
  CODEQL_ENABLE_EXPERIMENTAL_FEATURES_SWIFT: "true"
  DOTNET_GENERATE_ASPNET_CERTIFICATE: "false"
steps:
  - uses: ./../action/init
    with:
      tools: ${{ steps.prepare-test.outputs.tools-url }}
    env:
      TEST_MODE: true
  - name: Build code
    shell: bash
    run: ./build.sh
  - uses: ./../action/analyze
    id: analysis
    env:
      TEST_MODE: true
  - name: Check database
    shell: bash
    run: |
      SWIFT_DB="${{ fromJson(steps.analysis.outputs.db-locations).swift }}"
      if [[ ! -d "$SWIFT_DB" ]]; then
        echo "Did not create a database for Swift."
        exit 1
      fi
